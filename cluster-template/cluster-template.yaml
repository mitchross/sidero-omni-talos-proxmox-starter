# omnictl cluster template sync -v -f cluster-template.yaml
---
kind: Cluster
name: talos-prod-cluster
labels:
  cluster-id: "1"
kubernetes:
  version: v1.34.1
talos:
  version: v1.11.5
patches:
  - file: patches/cilium-cni.yaml
  - name: disable-default-cni
    inline:
      cluster:
        network:
          cni:
            name: none
        proxy:
          disabled: true
---
kind: ControlPlane
machineClass:
  name: proxmox-control-plane
  size: 3
systemExtensions:
  - siderolabs/iscsi-tools
  - siderolabs/nfsd
  - siderolabs/qemu-guest-agent
  - siderolabs/util-linux-tools
# patches:
# - inline:
#     cluster:
#       allowSchedulingOnControlPlanes: true
#   name: cp-schedulable
---
kind: Workers
name: workers
machineClass:
  name: proxmox-worker
  size: 3
systemExtensions:
  - siderolabs/iscsi-tools
  - siderolabs/nfsd
  - siderolabs/qemu-guest-agent
  - siderolabs/util-linux-tools
patches:
  - file: patches/disk-provisioning.yaml
---
kind: Workers
name: gpu-workers
machineClass:
  name: proxmox-gpu-worker
  size: 1
systemExtensions:
  # General-purpose extensions
  - siderolabs/iscsi-tools
  - siderolabs/nfsd
  - siderolabs/qemu-guest-agent
  - siderolabs/util-linux-tools
  # GPU-specific extensions
  - siderolabs/nonfree-kmod-nvidia
  - siderolabs/nvidia-container-toolkit
patches:
  - file: patches/gpu-worker.yaml
  - file: patches/disk-provisioning.yaml