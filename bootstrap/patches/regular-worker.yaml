apiVersion: v1alpha1
kind: MachinePatch
metadata:
  name: regular-worker-patch
  namespace: default
spec:
  description: "Configuration patch for regular Talos worker nodes"
  
  # Machine configuration patches
  machine:
    type: worker
    kubelet:
      nodeIP:
        validSubnets:
          - 0.0.0.0/0
      extraArgs:
        rotate-server-certificates: "true"
      extraMounts:
        - destination: /var/lib/longhorn
          type: bind
          source: /var/lib/longhorn
          options:
            - bind
            - rshared
            - rw
    
    # System disk configuration
    install:
      disk: /dev/sda
      image: ghcr.io/siderolabs/installer:v1.7.0
      wipe: false
    
    # Network configuration
    network:
      hostname: ""
      interfaces:
        - interface: eth0
          dhcp: true
    
    # Time sync
    time:
      servers:
        - time.cloudflare.com
    
    # Features
    features:
      rbac: true
      stableHostname: true
    
    # System extensions for storage
    kernel:
      modules:
        - name: iscsi_tcp
        - name: nvme-tcp
  
  # Cluster configuration patches
  cluster:
    network:
      cni: flannel
