version: '3.8'

services:
  omni-proxmox-provider:
    image: ghcr.io/siderolabs/omni-infra-provider-proxmox:latest
    container_name: omni-proxmox-provider
    restart: unless-stopped

    volumes:
      - ./config.yaml:/config.yaml:ro

    # Edit these values:
    command: >
      --config-file /config.yaml
      --omni-api-endpoint https://YOUR_OMNI_DOMAIN.com/
      --omni-service-account-key YOUR_SERVICE_ACCOUNT_KEY_HERE

    # Optional: Logging configuration
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

    # Health check (optional)
    healthcheck:
      test: ["CMD", "pgrep", "-f", "omni-infra-provider-proxmox"]
      interval: 30s
      timeout: 10s
      retries: 3

# For multiple Proxmox clusters, add more services:
#
#   omni-proxmox-provider-cluster2:
#     image: ghcr.io/siderolabs/omni-infra-provider-proxmox:latest
#     container_name: omni-proxmox-provider-cluster2
#     restart: unless-stopped
#     volumes:
#       - ./config-cluster2.yaml:/config.yaml:ro
#     command: >
#       --config-file /config.yaml
#       --omni-api-endpoint https://YOUR_OMNI_DOMAIN.com/
#       --omni-service-account-key YOUR_SERVICE_ACCOUNT_KEY_HERE
